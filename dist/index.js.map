{"version":3,"sources":["index.es6"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * @ngdoc overview\n * @name de.ds82.juice\n */\n\nvar path = require('path');\n\n//\n// Array.prototype.find polyfill\n// https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Array/find\n//\nif (!Array.prototype.find) {\n  Array.prototype.find = function(predicate) {\n    if (!this) {\n      throw new TypeError('Array.prototype.find called on null or undefined');\n    }\n    if (typeof predicate !== 'function') {\n      throw new TypeError('predicate must be a function');\n    }\n    var list = Object(this);\n    var length = list.length >>> 0;\n    var thisArg = arguments[1];\n    var value;\n\n    for (var i = 0; i < length; i++) {\n      value = list[i];\n      if (predicate.call(thisArg, value, i, list)) {\n        return value;\n      }\n    }\n    return undefined;\n  };\n}\n\nclass TinyDi {\n  constructor() {\n\n    this.resolving = [];\n\n    this.bindings = {};\n    this.nsBindings = [];\n\n    this.resolverFn = this.getDefaultResolver();\n  }\n\n  getDefaultResolver() {\n    return function(file) {\n      var filePath = path.join(path.dirname(require.main.filename), file);\n      try {\n        return require(filePath);\n      } catch (error1) {\n        try {\n          return require(file);\n        } catch (error2) {\n          console.log('ERROR: Cannot load module', file);\n          console.log('tried to require `' + filePath + '` and `' + file + '`');\n        }\n      }\n    };\n  }\n\n  resolveKey(key) {\n    if (this.hasBinding(key)) {\n      return key;\n    }\n\n    var moduleDelimiter = String(key).lastIndexOf('/');\n    var prefix = key.substring(0, moduleDelimiter);\n    var suffix = key.substring(moduleDelimiter);\n\n    if (prefix && prefix.length) {\n\n      var ns = this.nsBindings.find(function(element) {\n        return element.ns.match(prefix);\n      });\n\n      if (ns) {\n        return ns.path + suffix;\n      }\n    }\n\n    return key;\n  }\n\n  hasBinding(key) {\n    return !!this.bindings[key];\n  }\n\n  setResolver(resolverFn) {\n    this.resolverFn = resolverFn;\n  }\n\n  bind(key) {\n    return new Binding(this, key);\n  }\n\n  ns(space) {\n    return new PathBinding(this, space);\n  }\n\n  setNsBinding(ns, dir) {\n    this.nsBindings.push({ns: ns, path: dir});\n  }\n\n  set(key, object) {\n    this.bindings[key] = object;\n    return object;\n  }\n\n  load(key, what) {\n    what = this.resolveKey(what);\n    var resolved = this.resolverFn(what);\n\n    if (resolved) {\n      this.markResolving(key);\n      var object = this.apply(resolved);\n      this.set(key, object);\n      this.markResolved(key);\n      return object;\n    }\n  }\n\n  lazy(key) {\n    if (this.isCircularDep(key)) {\n      throw new Error('Circular dependency found; abort loading');\n    }\n    return this.load(key, key);\n  }\n\n  getBinding(key) {\n    var binding = this.bindings[key];\n    if (binding instanceof Lazy) {\n      return binding.load();\n    }\n    return binding;\n  }\n\n  get(key) {\n    return (this.bindings[key]) ?\n      this.getBinding(key) :\n      this.lazy(key);\n  }\n\n  apply(fn, that) {\n\n    if (fn && fn.$inject && typeof fn === 'function') {\n      var argumentList = fn.$inject.map(this.get, this);\n      return fn.apply(that, argumentList);\n    }\n    return fn;\n  }\n\n  markResolving(key) {\n    this.resolving.push(key);\n  }\n\n  markResolved(key) {\n    var index = this.resolving.indexOf(key);\n    if (index > -1) {\n      this.resolving.splice(index, 1);\n    }\n  }\n\n  isCircularDep(key) {\n    return (this.resolving.indexOf(key) > -1);\n  }\n}\n\nclass Lazy {\n  constructor(injector, key, path) {\n    this.injector = injector;\n    this.key = key;\n    this.path = path;\n  }\n\n  load() {\n    return this.injector.load(this.key, this.path);\n  }\n}\n\nclass Binding {\n  constructor(injector, key) {\n    this.injector = injector;\n    this.key = key;\n  }\n\n  to(object) {\n    this.injector.set(this.key, object);\n    return this.injector;\n  }\n\n  lazy(path) {\n    var lazyBind = new Lazy(this.injector, this.key, path);\n    this.injector.set(this.key, lazyBind);\n  }\n\n  apply(fn) {\n    this.injector.set(this.key, this.injector.apply(fn));\n  }\n\n  load(file) {\n    return this.injector.set(this.key, this.injector.get(file));\n  }\n}\n\nclass PathBinding {\n  constructor(injector, key) {\n    this.injector = injector;\n    this.key = key;\n  }\n\n  to(dir) {\n    this.injector.setNsBinding(this.key, dir);\n  }\n}\n\nmodule.exports = function() {\n  return new TinyDi();\n};\n"],"sourceRoot":"/source/"}