{"version":3,"sources":["index.es6"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * tiny-di\n * @module tiny-di\n * @copyright Dennis Saenger <tiny-di-15@mail.ds82.de>\n*/\n\nvar path = require('path');\n\nimport {GenericBinder} from './binder/generic';\nimport {PathBinder} from './binder/path';\nimport {ProviderBinder} from './binder/provider';\n\nimport {AbstractBinding} from './binding/abstract';\n\n// https://developer.mozilla.org/en/docs/Web/JavaScript/Guide/Regular_Expressions\nfunction escapeRegExp(string){\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nclass TinyDi {\n  constructor() {\n    this.logger = console.log;\n    this.resolving = [];\n\n    this.bindings = {};\n    this.nsBindings = [];\n\n    this.resolverFn = this.getDefaultResolver();\n  }\n\n  //\n  // PUBLIC DI API\n  //\n  setLogger(logger) {\n    this.logger = logger;\n  }\n\n  bind(key) {\n    return new GenericBinder(this, key);\n  }\n\n  ns(space) {\n    return new PathBinder(this, space);\n  }\n\n  get(key, env) {\n    if (Array.isArray(key)) {\n      return key.map(function(_key) {\n        return this.get(_key, env);\n      }, this);\n    }\n\n    return (this.bindings[key]) ?\n      this.getBinding(key, env) :\n      this.lazy(key);\n  }\n\n  provide(key) {\n    return new ProviderBinder(this, key);\n  }\n\n  setResolver(resolverFn) {\n    this.resolverFn = resolverFn;\n  }\n\n  set(key, object) {\n    this.bindings[key] = object;\n    return object;\n  }\n\n  //\n  // HELPER\n  //\n\n  getDefaultResolver(req) {\n    req = req || require;\n    var APP_ROOT = path.dirname(require.main.filename);\n\n    return function(file) {\n      var filePath = path.join(APP_ROOT, file);\n      try {\n        return req(filePath);\n      } catch (error1) {\n        try {\n          return req(file);\n        } catch (error2) {\n          this.logger('ERROR: Cannot load module', file);\n          this.logger('tried to require `' + filePath + '` and `' + file + '`');\n          this.logger(error1, error2, error1.stack, error2.stack);\n        }\n      }\n    };\n  }\n\n  resolveKey(key) {\n    if (this.hasBinding(key)) {\n      return key;\n    }\n\n    var prefix = Array.find(this.nsBindings, prefix => {\n      var re = new RegExp('^' + escapeRegExp(prefix.ns) + '.*');\n      return re.test(prefix.ns);\n    });\n\n    if (prefix) {\n      var re = new RegExp('^' + escapeRegExp(prefix.ns));\n      return key.replace(re, prefix.path);\n    }\n    return key;\n  }\n\n  hasBinding(key) {\n    return !!this.bindings[key];\n  }\n\n  setNsBinding(ns, dir) {\n    this.nsBindings.push({ns: ns, path: dir});\n  }\n\n  load(key, what) {\n    what = what || key;\n    what = this.resolveKey(what);\n    var resolved = this.resolverFn(what);\n\n    if (resolved) {\n      this.markResolving(key);\n      var object = this.apply(resolved, {key: key, binding: what});\n      this.set(key, object);\n      this.markResolved(key);\n      return object;\n    }\n  }\n\n  lazy(key) {\n    if (this.isCircularDep(key)) {\n      throw new Error('Circular dependency found; abort loading');\n    }\n    return this.load(key, key);\n  }\n\n  getBinding(key, env) {\n    var binding = this.bindings[key];\n    if (binding instanceof AbstractBinding) {\n      return binding.$get(env);\n    }\n    return binding;\n  }\n\n  apply(fn, env, that) {\n    var self = this;\n\n    if (fn && fn.$inject && typeof fn === 'function') {\n      var isArray = Array.isArray(fn.$inject);\n      var rawArgs = (isArray) ? fn.$inject : fn.$inject.deps || [];\n\n      var returnAsClass = !isArray && fn.$inject.callAs === 'class';\n      var argumentList = rawArgs.map(arg => self.get(arg, env), this);\n\n      return returnAsClass ?\n        new (Function.prototype.bind.apply(fn, [null].concat(argumentList)))() :\n        fn.apply(that, argumentList);\n    }\n    return fn;\n  }\n\n  markResolving(key) {\n    this.resolving.push(key);\n  }\n\n  markResolved(key) {\n    var index = this.resolving.indexOf(key);\n    if (index > -1) {\n      this.resolving.splice(index, 1);\n    }\n  }\n\n  isCircularDep(key) {\n    return (this.resolving.indexOf(key) > -1);\n  }\n}\n\nmodule.exports = function() {\n  return new TinyDi();\n};\n"],"sourceRoot":"/source/"}