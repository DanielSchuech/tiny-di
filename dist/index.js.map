{"version":3,"sources":["index.es6"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * tiny-di\n * @module tiny-di\n * @copyright Dennis Saenger <tiny-di-15@mail.ds82.de>\n*/\n\nvar path = require('path');\n\n// import {AbstractBase} from './base';\n\nimport {GenericBinder} from './binder/generic';\nimport {PathBinder} from './binder/path';\nimport {ProviderBinder} from './binder/provider';\n\nimport {AbstractBinding} from './binding/abstract';\n// import {LazyBinding} from './binding/lazy';\n\n//\n// include Array.find polyfill\n//\nfunction findPolyfill(list, predicate) {\n  if (!list) {\n    throw new TypeError('find called with null or undefined list');\n  }\n  if (typeof predicate !== 'function') {\n    throw new TypeError('predicate must be a function');\n  }\n  var length = list.length >>> 0;\n  var value;\n\n  for (var i = 0; i < length; i++) {\n    value = list[i];\n    if (predicate.call(list, value, i, list)) {\n      return value;\n    }\n  }\n  return undefined;\n}\n\nclass TinyDi {\n  constructor() {\n\n    this.resolving = [];\n\n    this.bindings = {};\n    this.nsBindings = [];\n\n    this.resolverFn = this.getDefaultResolver();\n  }\n\n  //\n  // PUBLIC DI API\n  //\n\n  bind(key) {\n    return new GenericBinder(this, key);\n  }\n\n  ns(space) {\n    return new PathBinder(this, space);\n  }\n\n  get(key, env) {\n    if (Array.isArray(key)) {\n      return key.map(function(_key) {\n        return this.get(_key, env);\n      }, this);\n    }\n\n    return (this.bindings[key]) ?\n      this.getBinding(key, env) :\n      this.lazy(key);\n  }\n\n  provide(key) {\n    return new ProviderBinder(this, key);\n  }\n\n  setResolver(resolverFn) {\n    this.resolverFn = resolverFn;\n  }\n\n   set(key, object) {\n    this.bindings[key] = object;\n    return object;\n  }\n\n  //\n  // HELPER\n  //\n\n  getDefaultResolver() {\n    return function(file) {\n      var filePath = path.join(path.dirname(require.main.filename), file);\n      try {\n        return require(filePath);\n      } catch (error1) {\n        try {\n          return require(file);\n        } catch (error2) {\n          console.log('ERROR: Cannot load module', file);\n          console.log('tried to require `' + filePath + '` and `' + file + '`');\n          console.log(error1.stack || error1);\n          console.log(error2.stack || error2);\n        }\n      }\n    };\n  }\n\n  resolveKey(key) {\n    if (this.hasBinding(key)) {\n      return key;\n    }\n\n    var moduleDelimiter = String(key).lastIndexOf('/');\n    var prefix = key.substring(0, moduleDelimiter);\n    var suffix = key.substring(moduleDelimiter);\n\n    if (prefix && prefix.length) {\n      var ns = findPolyfill(this.nsBindings, element => element.ns.match(prefix));\n      if (ns) {\n        return ns.path + suffix;\n      }\n    }\n\n    return key;\n  }\n\n  hasBinding(key) {\n    return !!this.bindings[key];\n  }\n\n  setNsBinding(ns, dir) {\n    this.nsBindings.push({ns: ns, path: dir});\n  }\n\n  load(key, what) {\n    what = what || key;\n    what = this.resolveKey(what);\n    var resolved = this.resolverFn(what);\n\n    if (resolved) {\n      this.markResolving(key);\n      var object = this.apply(resolved, {key: key, binding: what});\n      this.set(key, object);\n      this.markResolved(key);\n      return object;\n    }\n  }\n\n  lazy(key) {\n    if (this.isCircularDep(key)) {\n      throw new Error('Circular dependency found; abort loading');\n    }\n    return this.load(key, key);\n  }\n\n  getBinding(key, env) {\n    var binding = this.bindings[key];\n    if (binding instanceof AbstractBinding) {\n      return binding.$get(env);\n    }\n    return binding;\n  }\n\n  apply(fn, env, that) {\n    var self = this;\n\n    if (fn && fn.$inject && typeof fn === 'function') {\n      var isArray = Array.isArray(fn.$inject);\n      var rawArgs = (isArray) ? fn.$inject : fn.$inject.deps || [];\n\n      var returnAsClass = !isArray && fn.$inject.callAs === 'class';\n      var argumentList = rawArgs.map(arg => self.get(arg, env), this);\n\n      return returnAsClass ?\n        new (Function.prototype.bind.apply(fn, [null].concat(argumentList)))() :\n        fn.apply(that, argumentList);\n    }\n    return fn;\n  }\n\n  markResolving(key) {\n    this.resolving.push(key);\n  }\n\n  markResolved(key) {\n    var index = this.resolving.indexOf(key);\n    if (index > -1) {\n      this.resolving.splice(index, 1);\n    }\n  }\n\n  isCircularDep(key) {\n    return (this.resolving.indexOf(key) > -1);\n  }\n}\n\nmodule.exports = function() {\n  return new TinyDi();\n};\n"],"sourceRoot":"/source/"}